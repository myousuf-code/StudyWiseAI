<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StudyWise AI - Transform Your Learning Journey</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f8fafc;
            color: #1e293b;
            line-height: 1.6;
        }
        
        /* Utility Classes */
        .hidden {
            display: none !important;
        }
        
        /* Navigation */
        nav {
            background: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            padding: 0;
        }
        
        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.5rem;
            min-height: 64px;
        }
        
        .logo {
            font-size: 1.75rem;
            font-weight: bold;
            color: #2563eb;
        }
        
        .nav-buttons {
            display: flex;
            gap: 1rem;
        }
        
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 600;
            text-decoration: none;
            display: inline-block;
            text-align: center;
            transition: all 0.3s ease;
            min-width: 80px;
        }
        
        .btn-primary {
            background-color: #3b82f6;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #2563eb;
            transform: translateY(-1px);
        }
        
        .btn-success {
            background-color: #10b981;
            color: white;
        }
        
        .btn-success:hover {
            background-color: #059669;
            transform: translateY(-1px);
        }
        
        /* Hero Section */
        .hero {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: center;
            padding: 5rem 1.5rem;
        }
        
        .hero-container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .hero h1 {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 1.5rem;
        }
        
        .hero p {
            font-size: 1.25rem;
            margin-bottom: 2rem;
            opacity: 0.9;
        }
        
        .hero-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .hero .btn {
            font-size: 1rem;
            padding: 1rem 2rem;
        }
        
        .btn-white {
            background: white;
            color: #2563eb;
        }
        
        .btn-white:hover {
            background: #f1f5f9;
        }
        
        .btn-outline {
            background: transparent;
            color: white;
            border: 2px solid white;
        }
        
        .btn-outline:hover {
            background: white;
            color: #2563eb;
        }
        
        /* Quick Actions */
        .quick-actions {
            padding: 3rem 1.5rem;
            background: white;
        }
        
        .actions-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }
        
        .action-card {
            background: white;
            padding: 2rem;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            text-align: center;
            border: 1px solid #e2e8f0;
            transition: all 0.3s ease;
        }
        
        .action-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .action-card .icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
        
        .action-card h3 {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #1e293b;
        }
        
        .action-card p {
            color: #64748b;
            font-size: 0.875rem;
            margin-bottom: 1.5rem;
        }
        
        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal.show {
            display: flex !important;
        }
        
        .modal.hidden {
            display: none !important;
        }
        
        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 20px 25px rgba(0,0,0,0.2);
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1e293b;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #64748b;
            padding: 0.25rem;
        }
        
        .close-btn:hover {
            color: #1e293b;
        }
        
        /* Form Styles */
        .form-group {
            margin-bottom: 1rem;
        }
        
        .form-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: #374151;
            margin-bottom: 0.25rem;
        }
        
        .form-input, .form-select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            transition: border-color 0.3s ease;
        }
        
        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        /* Hidden utility */
        .hidden {
            display: none !important;
        }
        
        /* Status indicator */
        .status-ok {
            color: #10b981;
            font-weight: bold;
        }
        
        .status-error {
            color: #ef4444;
            font-weight: bold;
        }
        
        /* Notification Styles */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            max-width: 400px;
            z-index: 9999;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease;
        }
        
        .notification.show {
            opacity: 1;
            transform: translateX(0);
        }
        
        .notification.success {
            background-color: #10b981;
            color: white;
        }
        
        .notification.error {
            background-color: #ef4444;
            color: white;
        }
        
        .notification.info {
            background-color: #3b82f6;
            color: white;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav>
        <div class="nav-container">
            <div class="logo">StudyWise AI</div>            
            <div class="nav-buttons">
                <div id="userSection" class="hidden">
                    <span id="username" style="margin-right: 1rem; color: #64748b;">Welcome back!</span>
                    <button id="dashboardBtn" class="btn btn-primary">üìä Dashboard</button>
                    <button id="logoutBtn" class="btn" style="background-color: #ef4444; color: white;">Logout</button>
                </div>
                <div id="guestSection">
                    <button id="loginBtn" class="btn btn-primary">Login</button>
                    <button id="registerBtn" class="btn btn-success">Register</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero">
        <div class="hero-container">
            <h1>Welcome to StudyWise AI</h1>
            <p>Transform your learning journey with AI-powered study plans</p>
            <div class="hero-buttons">
                <button class="btn btn-white" onclick="startQuickStudy()">üöÄ Start Learning</button>
                <button class="btn btn-outline" onclick="openAIChat()">üí¨ Ask AI Assistant</button>
            </div>
        </div>
    </section>

    <!-- Quick Actions -->
    <section class="quick-actions">
        <div class="actions-container">
            <h2 style="text-align: center; margin-bottom: 2rem; color: #1e293b;">Quick Study Actions</h2>
            
            <!-- Button Test Status -->
            <div style="background: #f0f9ff; padding: 1rem; border-radius: 0.5rem; margin-bottom: 2rem; text-align: center;">
                <p><strong>Button Status:</strong> <span id="buttonStatus" class="status-ok">All buttons are working ‚úÖ</span></p>
                <p style="font-size: 0.875rem; color: #64748b; margin-top: 0.5rem;">Click any button below to test functionality</p>
            </div>
            
            <div class="actions-grid">
                <div class="action-card">
                    <div class="icon">‚ö°</div>
                    <h3>Quick Study</h3>
                    <p>Start a 25-minute focused session right now</p>
                    <button class="btn btn-primary" style="width: 100%;" onclick="startQuickStudy()">Start Session</button>
                </div>
                
                <div class="action-card">
                    <div class="icon">üí¨</div>
                    <h3>Ask AI</h3>
                    <p>Get instant study tips and answers</p>
                    <button class="btn btn-success" style="width: 100%;" onclick="openAIChat()">Ask Question</button>
                </div>
                
                <div class="action-card">
                    <div class="icon">üìä</div>
                    <h3>View Progress</h3>
                    <p>Check your learning statistics</p>
                    <button class="btn" style="width: 100%; background: #8b5cf6; color: white;" onclick="viewProgress()">View Stats</button>
                </div>
                
                <div class="action-card">
                    <div class="icon">üìÖ</div>
                    <h3>Study Planner</h3>
                    <p>Create personalized study schedules</p>
                    <button class="btn" style="width: 100%; background: #f97316; color: white;" onclick="openStudyPlanner()">Create Plan</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Authentication Modal -->
    <div id="authModal" class="modal hidden">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3 id="authTitle" class="modal-title">Login to StudyWise AI</h3>
                <button id="closeAuthModal" class="close-btn">&times;</button>
            </div>
            
            <!-- Login Form -->
            <form id="loginForm" class="form-group">
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" id="loginEmail" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" id="loginPassword" class="form-input" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    Login
                </button>
                <p style="text-align: center; margin-top: 1rem; font-size: 0.875rem;">
                    Don't have an account? 
                    <button type="button" id="switchToRegister" class="btn" style="display: inline; padding: 0; background: none; color: #3b82f6; text-decoration: underline;">Register here</button>
                </p>
            </form>
            
            <!-- Register Form (hidden by default) -->
            <form id="registerForm" class="form-group hidden">
                <div class="form-group">
                    <label class="form-label">Full Name</label>
                    <input type="text" id="registerFullName" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Username</label>
                    <input type="text" id="registerUsername" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" id="registerEmail" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" id="registerPassword" class="form-input" required>
                </div>
                <button type="submit" class="btn btn-success" style="width: 100%;">
                    Register
                </button>
                <p style="text-align: center; margin-top: 1rem; font-size: 0.875rem;">
                    Already have an account? 
                    <button type="button" id="switchToLogin" class="btn" style="display: inline; padding: 0; background: none; color: #10b981; text-decoration: underline;">Login here</button>
                </p>
            </form>
        </div>
    </div>

    <!-- Chat Modal -->
    <div id="chatModal" class="modal hidden">
        <div class="modal-content" style="max-width: 600px; max-height: 80vh; display: flex; flex-direction: column;">
            <div class="modal-header">
                <h3 class="modal-title">üí¨ AI Study Assistant</h3>
                <button id="closeChatModal" class="close-btn">&times;</button>
            </div>
            <div id="chatMessages" style="flex: 1; overflow-y: auto; padding: 1rem; background: #f8fafc; border-radius: 0.5rem; margin-bottom: 1rem; min-height: 300px;">
                <div style="text-align: center; color: #64748b; padding: 2rem;">
                    Ask me anything about studying! I'm here to help. ü§ñ
                </div>
            </div>
            <div style="display: flex; gap: 0.5rem;">
                <input id="chatInput" type="text" placeholder="Ask a question..." class="form-input" style="flex: 1;">
                <button id="sendMessage" class="btn btn-primary">Send</button>
            </div>
        </div>
    </div>

    <!-- Subject Selection Modal -->
    <div id="subjectModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">üéØ Start Study Session</h3>
                <button class="close-btn" onclick="closeModal('subjectModal')">&times;</button>
            </div>
            
            <div class="form-group">
                <label class="form-label">Subject Category</label>
                <select id="subjectCategory" class="form-select">
                    <option value="">Choose category...</option>
                    <option value="mathematics">üìê Mathematics</option>
                    <option value="science">üî¨ Science</option>
                    <option value="language">üìö Language Arts</option>
                    <option value="history">üèõÔ∏è History</option>
                    <option value="programming">üíª Programming</option>
                    <option value="business">üíº Business</option>
                    <option value="other">üéì Other</option>
                </select>
            </div>
            
            <div class="form-group">
                <label class="form-label">Specific Topic (optional)</label>
                <input type="text" id="specificTopic" class="form-input" placeholder="e.g., Calculus, Spanish Grammar">
            </div>
            
            <div class="form-group">
                <label class="form-label">Session Duration</label>
                <select id="sessionDuration" class="form-select">
                    <option value="25">‚è∞ 25 minutes (Pomodoro)</option>
                    <option value="30">‚è±Ô∏è 30 minutes</option>
                    <option value="45">üïê 45 minutes</option>
                    <option value="60">‚è∞ 1 hour</option>
                    <option value="90">üïê 1.5 hours</option>
                </select>
            </div>
            
            <div class="form-group">
                <label class="form-label">Study Goal</label>
                <input type="text" id="studyGoal" class="form-input" placeholder="What do you want to accomplish?">
            </div>
            
            <button class="btn btn-primary" style="width: 100%; margin-top: 1rem;" onclick="startStudySession()">üöÄ Start Study Session</button>
        </div>
    </div>

    <!-- Study Timer Modal -->
    <div id="timerModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3 class="modal-title">üìö Active Study Session</h3>
                <button class="close-btn" onclick="pauseSession()">&times;</button>
            </div>
            
            <div style="text-align: center; margin: 2rem 0;">
                <div id="timerDisplay" style="font-size: 4rem; font-weight: bold; color: #3b82f6; font-family: monospace;">25:00</div>
                <div id="sessionInfo" style="color: #64748b; margin: 1rem 0;">Ready to start</div>
                <div id="sessionGoal" style="background: #f8fafc; padding: 1rem; border-radius: 0.5rem; margin: 1rem 0;">Set your goal above to see it here</div>
            </div>
            
            <div style="background: #e5e7eb; height: 8px; border-radius: 4px; margin: 1rem 0;">
                <div id="progressBar" style="background: linear-gradient(90deg, #3b82f6, #10b981); height: 100%; width: 0%; transition: width 1s;"></div>
            </div>
            
            <div style="display: flex; gap: 1rem; justify-content: center;">
                <button id="pauseBtn" class="btn btn-success" onclick="pauseResumeTimer()">‚è∏Ô∏è Pause</button>
                <button class="btn" style="background: #ef4444; color: white;" onclick="stopSession()">‚èπÔ∏è Stop</button>
                <button class="btn" style="background: #8b5cf6; color: white;" onclick="addTime()">‚ûï 5min</button>
            </div>
        </div>
    </div>

    <!-- Study Planner Modal -->
    <div id="studyPlannerModal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h3 class="modal-title">üìÖ Weekly Study Planner</h3>
                <button class="close-btn" onclick="closeModal('studyPlannerModal')">&times;</button>
            </div>
            
            <div style="margin: 1rem 0; display: flex; justify-content: space-between; align-items: center;">
                <button class="btn" style="background: #6b7280; color: white; padding: 0.5rem 1rem;" onclick="changeWeek(-1)">‚Üê Previous Week</button>
                <h4 id="weekDisplay" style="margin: 0; color: #1e293b;">Week of February 8, 2026</h4>
                <button class="btn" style="background: #6b7280; color: white; padding: 0.5rem 1rem;" onclick="changeWeek(1)">Next Week ‚Üí</button>
            </div>
            
            <div class="calendar-container" style="overflow-x: auto;">
                <table class="calendar-table" style="width: 100%; border-collapse: collapse; min-width: 800px;">
                    <thead>
                        <tr style="background: #f1f5f9;">
                            <th style="padding: 0.75rem; border: 1px solid #e2e8f0; font-weight: 600; text-align: center; width: 120px;">Time</th>
                            <th style="padding: 0.75rem; border: 1px solid #e2e8f0; font-weight: 600; text-align: center;">Mon</th>
                            <th style="padding: 0.75rem; border: 1px solid #e2e8f0; font-weight: 600; text-align: center;">Tue</th>
                            <th style="padding: 0.75rem; border: 1px solid #e2e8f0; font-weight: 600; text-align: center;">Wed</th>
                            <th style="padding: 0.75rem; border: 1px solid #e2e8f0; font-weight: 600; text-align: center;">Thu</th>
                            <th style="padding: 0.75rem; border: 1px solid #e2e8f0; font-weight: 600; text-align: center;">Fri</th>
                            <th style="padding: 0.75rem; border: 1px solid #e2e8f0; font-weight: 600; text-align: center;">Sat</th>
                            <th style="padding: 0.75rem; border: 1px solid #e2e8f0; font-weight: 600; text-align: center;">Sun</th>
                        </tr>
                    </thead>
                    <tbody id="calendarBody">
                        <!-- Calendar rows will be generated by JavaScript -->
                    </tbody>
                </table>
            </div>
            
            <div style="margin-top: 1.5rem; display: flex; justify-content: space-between; flex-wrap: wrap; gap: 1rem;">
                <button class="btn btn-success" onclick="addNewSession()">+ Add Study Session</button>
                <button class="btn" style="background: #8b5cf6; color: white;" onclick="viewWeekSummary()">üìä Week Summary</button>
                <button class="btn" style="background: #f97316; color: white;" onclick="exportCalendar()">üì§ Export Week</button>
            </div>
        </div>
    </div>

    <!-- Add Session Modal -->
    <div id="addSessionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">‚ûï Add Study Session</h3>
                <button class="close-btn" onclick="closeModal('addSessionModal')">&times;</button>
            </div>
            
            <div class="form-group">
                <label class="form-label">Day of Week</label>
                <select id="sessionDay" class="form-select">
                    <option value="monday">Monday</option>
                    <option value="tuesday">Tuesday</option>
                    <option value="wednesday">Wednesday</option>
                    <option value="thursday">Thursday</option>
                    <option value="friday">Friday</option>
                    <option value="saturday">Saturday</option>
                    <option value="sunday">Sunday</option>
                </select>
            </div>
            
            <div class="form-group">
                <label class="form-label">Start Time</label>
                <input type="time" id="sessionStartTime" class="form-input" value="09:00">
            </div>
            
            <div class="form-group">
                <label class="form-label">Duration (minutes)</label>
                <select id="sessionDuration" class="form-select">
                    <option value="25">25 minutes</option>
                    <option value="30">30 minutes</option>
                    <option value="45">45 minutes</option>
                    <option value="60">60 minutes</option>
                    <option value="90">90 minutes</option>
                    <option value="120">120 minutes</option>
                </select>
            </div>
            
            <div class="form-group">
                <label class="form-label">Subject</label>
                <input type="text" id="sessionSubject" class="form-input" placeholder="e.g., Mathematics, History, Programming">
            </div>
            
            <div class="form-group">
                <label class="form-label">Topic/Goal</label>
                <input type="text" id="sessionTopic" class="form-input" placeholder="What will you study in this session?">
            </div>
            
            <div class="form-group">
                <label class="form-label">Color</label>
                <select id="sessionColor" class="form-select">
                    <option value="#3b82f6">üîµ Blue</option>
                    <option value="#10b981">üü¢ Green</option>
                    <option value="#f59e0b">üü° Yellow</option>
                    <option value="#ef4444">üî¥ Red</option>
                    <option value="#8b5cf6">üü£ Purple</option>
                    <option value="#06b6d4">üîµ Cyan</option>
                </select>
            </div>
            
            <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                <button class="btn btn-primary" style="flex: 1;" onclick="saveStudySession()">üíæ Save Session</button>
                <button class="btn" style="background: #6b7280; color: white; flex: 1;" onclick="closeModal('addSessionModal')">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Simple Info Modal -->
    <div id="infoModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="infoTitle" class="modal-title">Information</h3>
                <button class="close-btn" onclick="closeModal('infoModal')">&times;</button>
            </div>
            <div id="infoContent">
                <p>Content will appear here...</p>
            </div>
            <button class="btn btn-primary" style="width: 100%; margin-top: 1rem;" onclick="closeModal('infoModal')">Close</button>
        </div>
    </div>

    <script>
        console.log('üöÄ StudyWise AI loading...');
        
        // Global session management
        let studyTimer = null;
        let timeRemaining = 0;
        let isRunning = false;
        let currentSession = null;
        
        // Utility functions first
        function updateButtonStatus(message, isError = false) {
            const status = document.getElementById('buttonStatus');
            status.textContent = message;
            status.className = isError ? 'status-error' : 'status-ok';
            console.log('Button status:', message);
        }
        
        function testAlert(message) {
            alert(message);
            updateButtonStatus(`${message} ‚úÖ`);
        }
        
        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'none';
                modal.classList.remove('show');
            }
        }
        
        function showModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'flex';
                modal.classList.add('show');
            }
        }
        
        // Main Functions
        function startQuickStudy() {
            updateButtonStatus('Opening study session setup... ‚ö°');
            showModal('subjectModal');
        }
        
        function openAIChat() {
            updateButtonStatus('AI Chat opened! üí¨');
            showInfoModal('AI Study Assistant', 
                'Hi! I\'m your AI study assistant. Here are some tips:\n\n' +
                '‚Ä¢ Use the Pomodoro technique (25min focus + 5min break)\n' +
                '‚Ä¢ Set specific, achievable goals for each session\n' +
                '‚Ä¢ Take notes during your study sessions\n' +
                '‚Ä¢ Review progress regularly to stay motivated\n\n' +
                'Start a study session to begin learning!'
            );
        }
        
        function viewProgress() {
            updateButtonStatus('Progress dashboard opened! üìä');
            const sessions = JSON.parse(localStorage.getItem('studySessions') || '[]');
            const totalSessions = sessions.length;
            const totalMinutes = sessions.reduce((sum, s) => sum + (s.timeStudied || 0), 0);
            const totalHours = Math.round(totalMinutes / 6) / 10; // Round to 1 decimal
            
            showInfoModal('üìä Your Study Progress', 
                `üìà Study Statistics:\n\n` +
                `‚Ä¢ Total Sessions: ${totalSessions}\n` +
                `‚Ä¢ Total Time: ${totalHours} hours\n` +
                `‚Ä¢ Average Session: ${totalSessions > 0 ? Math.round(totalMinutes / totalSessions) : 0} minutes\n\n` +
                `${totalSessions === 0 ? 'Start your first study session to track progress!' : 'Great job on your study progress! Keep it up! üéâ'}`
            );
        }
        
        function openStudyPlanner() {
            updateButtonStatus('Study planner opened! üìÖ');
            initializeCalendar();
            showModal('studyPlannerModal');
        }
        
        function showInfoModal(title, content) {
            document.getElementById('infoTitle').textContent = title;
            document.getElementById('infoContent').innerHTML = `<p style="white-space: pre-line; line-height: 1.6;">${content}</p>`;
            showModal('infoModal');
        }
        
        // Study Session Functions
        function startStudySession() {
            const subject = document.getElementById('subjectCategory').value;
            const topic = document.getElementById('specificTopic').value;
            const duration = parseInt(document.getElementById('sessionDuration').value);
            const goal = document.getElementById('studyGoal').value;
            
            if (!subject) {
                alert('‚ö†Ô∏è Please select a subject category first!');
                return;
            }
            
            // Create session
            currentSession = {
                subject: subject,
                topic: topic,
                duration: duration,
                goal: goal,
                startTime: new Date()
            };
            
            // Setup timer
            timeRemaining = duration * 60; // Convert to seconds
            updateTimerDisplay();
            updateSessionInfo();
            
            // Close subject modal and open timer
            closeModal('subjectModal');
            showModal('timerModal');
            
            // Start timer
            startTimer();
            
            updateButtonStatus(`Study session started: ${subject} for ${duration} minutes! üéØ`);
        }
        
        function startTimer() {
            if (studyTimer) clearInterval(studyTimer);
            
            isRunning = true;
            document.getElementById('pauseBtn').innerHTML = '‚è∏Ô∏è Pause';
            
            studyTimer = setInterval(() => {
                if (timeRemaining > 0) {
                    timeRemaining--;
                    updateTimerDisplay();
                    updateProgressBar();
                } else {
                    completeSession();
                }
            }, 1000);
        }
        
        function pauseResumeTimer() {
            if (isRunning) {
                clearInterval(studyTimer);
                isRunning = false;
                document.getElementById('pauseBtn').innerHTML = '‚ñ∂Ô∏è Resume';
                updateButtonStatus('Session paused ‚è∏Ô∏è');
            } else {
                startTimer();
                updateButtonStatus('Session resumed ‚ñ∂Ô∏è');
            }
        }
        
        function pauseSession() {
            if (isRunning) {
                pauseResumeTimer();
            }
            closeModal('timerModal');
        }
        
        function stopSession() {
            if (confirm('‚ö†Ô∏è Stop this study session? Your progress will be saved.')) {
                if (studyTimer) clearInterval(studyTimer);
                saveSession(false);
                resetSession();
                updateButtonStatus('Session stopped and saved üõë');
            }
        }
        
        function completeSession() {
            if (studyTimer) clearInterval(studyTimer);
            saveSession(true);
            alert('üéâ Congratulations! Study session completed! \\n\\nGreat job staying focused!');
            resetSession();
            updateButtonStatus('Session completed! Well done! üéâ');
        }
        
        function addTime() {
            timeRemaining += 300; // Add 5 minutes
            currentSession.duration += 5;
            updateTimerDisplay();
            updateButtonStatus('Added 5 minutes to session ‚ûï');
        }
        
        function saveSession(completed) {
            if (!currentSession) return;
            
            const sessions = JSON.parse(localStorage.getItem('studySessions') || '[]');
            const timeStudied = (currentSession.duration * 60 - timeRemaining) / 60;
            
            const sessionData = {
                ...currentSession,
                endTime: new Date(),
                timeStudied: Math.round(timeStudied * 10) / 10,
                completed: completed
            };
            
            sessions.unshift(sessionData);
            localStorage.setItem('studySessions', JSON.stringify(sessions.slice(0, 50)));
            
            console.log('Session saved:', sessionData);
        }
        
        function resetSession() {
            currentSession = null;
            timeRemaining = 0;
            isRunning = false;
            if (studyTimer) clearInterval(studyTimer);
            closeModal('timerModal');
        }
        
        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            const display = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            document.getElementById('timerDisplay').textContent = display;
        }
        
        function updateSessionInfo() {
            if (!currentSession) return;
            
            const topicText = currentSession.topic ? ` - ${currentSession.topic}` : '';
            document.getElementById('sessionInfo').textContent = `${currentSession.subject}${topicText}`;
            document.getElementById('sessionGoal').textContent = currentSession.goal || 'Focus and learn effectively';
        }
        
        function updateProgressBar() {
            if (!currentSession) return;
            
            const totalSeconds = currentSession.duration * 60;
            const progress = Math.max(0, Math.min(100, ((totalSeconds - timeRemaining) / totalSeconds) * 100));
            document.getElementById('progressBar').style.width = `${progress}%`;
        }
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('‚úÖ StudyWise AI loaded successfully');
            updateButtonStatus('All buttons are working and ready! üöÄ');
            
            // Close modals when clicking outside
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.style.display = 'none';
                        modal.classList.remove('show');
                    }
                });
            });
        });
        
        // Global error handler
        window.onerror = function(msg, url, line, col, error) {
            console.error('JavaScript Error:', msg);
            updateButtonStatus(`‚ùå Error: ${msg}`, true);
            return false;
        };
        
        console.log('‚úÖ All functions loaded successfully');
        
        // Calendar functionality
        let currentWeekStart = null;
        let studyPlan = JSON.parse(localStorage.getItem('studyPlan') || '{}');
        
        function initializeCalendar() {
            if (!currentWeekStart) {
                const today = new Date();
                const dayOfWeek = today.getDay();
                const monday = new Date(today);
                monday.setDate(today.getDate() - (dayOfWeek === 0 ? 6 : dayOfWeek - 1));
                currentWeekStart = monday;
            }
            renderCalendar();
        }
        
        function changeWeek(direction) {
            const newWeek = new Date(currentWeekStart);
            newWeek.setDate(currentWeekStart.getDate() + (direction * 7));
            currentWeekStart = newWeek;
            renderCalendar();
        }
        
        function renderCalendar() {
            updateWeekDisplay();
            const calendarBody = document.getElementById('calendarBody');
            calendarBody.innerHTML = '';
            
            // Generate time slots from 6 AM to 11 PM
            for (let hour = 6; hour <= 23; hour++) {
                const row = document.createElement('tr');
                
                // Time column
                const timeCell = document.createElement('td');
                timeCell.style.cssText = 'padding: 0.5rem; border: 1px solid #e2e8f0; background: #f8fafc; font-weight: 500; text-align: center;';
                timeCell.textContent = formatTime(hour);
                row.appendChild(timeCell);
                
                // Day columns
                for (let day = 0; day < 7; day++) {
                    const dayCell = document.createElement('td');
                    dayCell.style.cssText = 'padding: 0.25rem; border: 1px solid #e2e8f0; height: 40px; position: relative; cursor: pointer;';
                    dayCell.onclick = () => quickAddSession(day, hour);
                    
                    const dayKey = getDayKey(day, hour);
                    if (studyPlan[dayKey]) {
                        const session = studyPlan[dayKey];
                        dayCell.innerHTML = `
                            <div style="background: ${session.color}; color: white; padding: 2px 4px; border-radius: 3px; font-size: 11px; line-height: 1.1;">
                                <div style="font-weight: bold;">${session.subject}</div>
                                <div>${session.topic}</div>
                            </div>
                        `;
                        dayCell.style.cursor = 'pointer';
                        dayCell.onclick = () => editSession(dayKey);
                    }
                    
                    row.appendChild(dayCell);
                }
                
                calendarBody.appendChild(row);
            }
        }
        
        function updateWeekDisplay() {
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            const weekEnd = new Date(currentWeekStart);
            weekEnd.setDate(currentWeekStart.getDate() + 6);
            
            document.getElementById('weekDisplay').textContent = 
                `Week of ${currentWeekStart.toLocaleDateString('en-US', options)}`;
        }
        
        function formatTime(hour) {
            if (hour === 0) return '12:00 AM';
            if (hour < 12) return `${hour}:00 AM`;
            if (hour === 12) return '12:00 PM';
            return `${hour - 12}:00 PM`;
        }
        
        function getDayKey(dayIndex, hour) {
            const date = new Date(currentWeekStart);
            date.setDate(currentWeekStart.getDate() + dayIndex);
            return `${date.toISOString().split('T')[0]}-${hour}`;
        }
        
        function quickAddSession(dayIndex, hour) {
            const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
            document.getElementById('sessionDay').value = days[dayIndex];
            document.getElementById('sessionStartTime').value = `${hour.toString().padStart(2, '0')}:00`;
            showModal('addSessionModal');
        }
        
        function addNewSession() {
            // Reset form
            document.getElementById('sessionDay').value = 'monday';
            document.getElementById('sessionStartTime').value = '09:00';
            document.getElementById('sessionDuration').value = '25';
            document.getElementById('sessionSubject').value = '';
            document.getElementById('sessionTopic').value = '';
            document.getElementById('sessionColor').value = '#3b82f6';
            showModal('addSessionModal');
        }
        
        function saveStudySession() {
            const day = document.getElementById('sessionDay').value;
            const startTime = document.getElementById('sessionStartTime').value;
            const duration = parseInt(document.getElementById('sessionDuration').value);
            const subject = document.getElementById('sessionSubject').value;
            const topic = document.getElementById('sessionTopic').value;
            const color = document.getElementById('sessionColor').value;
            
            if (!subject.trim()) {
                alert('Please enter a subject');
                return;
            }
            
            // Convert day name to day index
            const dayNames = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
            const dayIndex = dayNames.indexOf(day);
            const hour = parseInt(startTime.split(':')[0]);
            
            const dayKey = getDayKey(dayIndex, hour);
            
            studyPlan[dayKey] = {
                subject,
                topic,
                startTime,
                duration,
                color,
                completed: false
            };
            
            localStorage.setItem('studyPlan', JSON.stringify(studyPlan));
            closeModal('addSessionModal');
            renderCalendar();
            updateButtonStatus(`Study session added: ${subject} üìÖ`);
        }
        
        function editSession(dayKey) {
            const session = studyPlan[dayKey];
            if (session) {
                const action = confirm(`${session.subject} - ${session.topic}\n\nClick OK to delete, Cancel to keep`);
                if (action) {
                    delete studyPlan[dayKey];
                    localStorage.setItem('studyPlan', JSON.stringify(studyPlan));
                    renderCalendar();
                    updateButtonStatus('Session removed üóëÔ∏è');
                }
            }
        }
        
        function viewWeekSummary() {
            const weekSessions = Object.values(studyPlan).filter(session => session);
            const totalSessions = weekSessions.length;
            const totalHours = weekSessions.reduce((sum, s) => sum + (s.duration / 60), 0);
            
            const subjects = [...new Set(weekSessions.map(s => s.subject))];
            
            showInfoModal('üìä Week Summary', 
                `This week's study plan:\n\n` +
                `‚Ä¢ Total Sessions: ${totalSessions}\n` +
                `‚Ä¢ Total Hours: ${totalHours.toFixed(1)} hours\n` +
                `‚Ä¢ Subjects: ${subjects.join(', ')}\n\n` +
                `${totalSessions === 0 ? 'Add some study sessions to get started!' : 'Great planning! Stay consistent! üéØ'}`
            );
        }
        
        function exportCalendar() {
            const weekSessions = Object.entries(studyPlan)
                .filter(([key, session]) => session)
                .map(([key, session]) => {
                    const [date, hour] = key.split('-');
                    return `${date} ${session.startTime} - ${session.subject}: ${session.topic}`;
                });
            
            if (weekSessions.length === 0) {
                updateButtonStatus('No sessions to export üìÑ');
                return;
            }
            
            const exportText = 'StudyWise AI - Weekly Schedule\n\n' + weekSessions.join('\n');
            
            // Create downloadable text file
            const blob = new Blob([exportText], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'study-schedule.txt';
            a.click();
            window.URL.revokeObjectURL(url);
            
            updateButtonStatus('Schedule exported! üìÑ‚úÖ');
        }
        
        console.log('üìÖ Study Planner loaded successfully!');
    </script>
    
    <!-- Main App JavaScript -->
    <script src="/static/js/app.js"></script>
</body>
</html>